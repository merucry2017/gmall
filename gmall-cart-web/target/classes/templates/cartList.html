<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <script src="/js/jquery-3.1.1.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/bootstrap/js/bootstrap.js"></script>
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" href="/css/One_mainFoot.css">
    <link rel="stylesheet" href="/css/font-awesome-4.7.0/css/font-awesome.css" />
    <link rel="icon" href="/img/心04.png" type="/image/x-icon"/>
    <link rel="stylesheet" href="/css/One_bdyStyle.css">
    <link rel="stylesheet" href="/css/index.css">
</head>
<body>
<header>
    <a name="mao1">
        <div class="header">

            <ul class="header-left">
                <li>

                    <a th:href="'http://search.gmall.com:8083/index?nickname='+${nickname}+'&token='+${token}">首页</a>
                </li>

            </ul>
            <ul class="header-right">
                <li><a href="../登录页面\index.html" style="color: red;" th:if="${nickname}!=null" th:text="'您好,' + ${nickname}">你好，请登录</a></li>
                <li><a href="../注册页面\index.html" >免费注册</a></li>
                <li class="spacer"></li>
                <li><a href="">我的订单</a></li>
                <li class="spacer"></li>

            </ul>
            <div style="clear: both;"></div>
        </div>

    </a>
</header>




<div class="one_search">

    <div class="one_sousuo">
        <div class="one_search_top">
            <div class="one_top_left">
                <a th:href="'http://search.gmall.com:8083/index?nickname='+${nickname}+'&token='+${token}" class="one_left_logo"><img src="img/logo1.jpg"></a>
                <a href="#" class="one_left_link">购物车</a>
            </div>
            <div class="one_top_right">
                <input id="searchText" type="text" class="one_right_txt" placeholder="" onfocus="this.placeholder=''"  onblur="this.placeholder='' ">
                <input onclick="search()" type="button" value="搜索" class="one_right_btn">
            </div>
        </div>
        <div class="one_search_load"   th:if="${userId}==null" >
            <img src="/img/shop_07.jpg" class="one_load_wraing">
            <span>您还没有登录！登录后购物车的商品将保存到您账号中</span>
            <a href="#"><input type="button" onclick="login()" value="立即登录" class="one_load_btn"></a>
        </div>
    </div>
</div>
<div class="One_BdyShop">
    <div class="OneBdy_box">
        <div class="One_tabTop">
            <div class="One_Topleft">
                <span>全部商品 </span>

            </div>

        </div>
        <div class="One_ShopTop">
            <ul>
                <li><input type="checkbox" class="allCheck" onchange="allCheckSku(this)">全选</li>
                <li>商品</li>
                <li>单价</li>
                <li>数量</li>
                <li>小计</li>
                <li>操作</li>
            </ul>
        </div>

        <div id="cartListInner" th:include="cartListInner"></div>
    </div>
</div>

<div class="One_isDel">
    <p>
        <span>删除</span><span><img src="img/错误.png" alt=""></span>
    </p>
    <div>
        <dl>
            <dt><img src="img/感叹三角形 (2).png" alt=""></dt>
            <dd>
                <li>删除商品？</li>
                <li>您可以选择移到关注，或删除商品。</li>
            </dd>
            </dl>
    </div>
    <div>
        <button type="button">删除</button>

    </div>
</div>
<div class="One_moveGzIfNull">
    <p>
        <span>删除</span><span><img src="img/错误.png" alt=""></span>
    </p>
    <dl>
        <dt><img src="img/感叹三角形 (2).png" alt=""></dt>
        <dd>请至少选中一件商品！</dd>
    </dl>
</div>
<div class="One_moveMyGz">
    <p>
        <span>删除</span><span><img src="img/错误.png" alt=""></span>
    </p>
    <div>
        <dl>
            <dt><img src="img/感叹三角形 (2).png" alt=""></dt>
            <dd>
                <li>移到关注</li>
                <li>移动后选中商品将不再购物车中显示</li>
            </dd>
            </dl>
    </div>
    <div>
        <button type="button">确定</button>
        <button type="button">取消</button>
    </div>
</div>
<div class="One_clearShop">
    <p>
        <span>提示</span><span><img src="img/错误.png" alt=""></span>
    </p>
    <dl>
        <dt><img src="img/感叹三角形 (2).png" alt=""></dt>
        <dd>没有下柜商品!</dd>
    </dl>
</div>


<!--底部-->

<div class="one_footer">

</div>
</body>
<script src="/js/index.js" charset="utf-8"></script>
<script src="/jquery/layer/layer.js" charset="utf-8"></script>
<!--<script src="/js/cartList.js" charset="utf-8"></script>-->
<script type="text/javascript">

    var token;
    $(document).ready(function () {
        token = getQueryVariable("token");
    })

    function getQueryVariable(variable)
    {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if(pair[0] == variable){return pair[1];}
        }
        return(false);
    }

    function deleteFromCart(skuId) {
        let url = 'http://cart.gmall.com:8084/deleteFromCart?skuId='+skuId+'&token='+token;
        var loadingIndex = -1;
        $.ajax({
            url:url,
            type:'DELETE',
            dataType:'json',
            beforeSend : function () {
                //表单校验
                loadingIndex = layer.msg('处理中', {icon: 16});
                return true;
            },
            success : function(result) {
                layer.close(loadingIndex);
                if (result.success) {
                    window.location.href="http://cart.gmall.com:8084/cartList?token="+token
                } else {
                    layer.msg(result.message , {time: 1000, icon: 5, shift: 6});
                }
            },
            error : function(){
                layer.msg("删除失败！", {time: 1000, icon: 5, shift: 6});
            }
        })
    }

    function toTrade(){
        // var cartList = document.getElementsByName("productSkuId");
        // console.log(cartList);
        window.location.href="http://order.gmall.com:8086/toTrade?token="+token;
    }
    function toItem(skuId) {
        window.location.href="http://item.gmall.com:8082/"+skuId+".html?token="+token;
    }

    function login(){
      var s = encodeURIComponent("http://cart.gmall.com:8084/cartList");
       window.location.href="http://passport.atguigu.com/index?originUrl="+s+"&token="+token;
    }

    function search() {
        var keyword=$("#searchText").val()
        window.location.href="http://search.gmall.com:8083/list.html?keyword="+keyword+"&token="+token;
    }

    function checkSku( chkbox){
        var skuId= $(chkbox).attr("value");
        var checked=$(chkbox).prop("checked");
        var isCheckedFlag="0";
        if(checked){
            isCheckedFlag="1";
        }
        $.post("checkCart","isChecked="+isCheckedFlag+"&"+"skuId="+skuId,function (html) {
            // 服务会返回一个inner内嵌页面给ajax，我们返回的新的页面刷新替换掉原来的老的页面
            $("#cartListInner").html(html);
        });
    }

    function allCheckSku( chkbox){
        var checked=$(chkbox).prop("checked");
        var isCheckedFlag="0";
        if(checked){
            isCheckedFlag="1";
        }
        $.post("allCheckCart","isChecked="+isCheckedFlag,function (html) {
            // 服务会返回一个inner内嵌页面给ajax，我们返回的新的页面刷新替换掉原来的老的页面
            $("#cartListInner").html(html);
        });
    }
    
    function changeQuantity() {

    }

</script>
</html>

